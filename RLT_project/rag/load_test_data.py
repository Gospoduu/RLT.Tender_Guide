# load_test_data.py

import json
from qdrant_client import QdrantClient
from qdrant_client.http import models
from .embed_query import get_embedding  # твоя функция
import uuid

# === Тестовые документы ===
docs = [
  {
    "title": "Как регистрироваться поставщикам",
    "url": "https://www.roseltorg.ru/knowledge_db/registration/article/suppliers",
    "text": "Хочу предлагать мои товары, работы и услуги государственным, муниципальным и иным учреждениям на торгах по 44-ФЗ.\n\nГде и как мне регистрироваться? Юрлица, ИП (в т. ч. субъекты МСП), физлица (в т. ч. самозанятые): сначала в ЕИС в сфере закупок. Затем на этой странице сайта Росэлторг войдите, выбрав способ «Госуслуги». Хочу предлагать мои товары, работы и услуги госкорпорациям и иным учреждениям на торгах по 223-ФЗ.\n\nГде и как мне регистрироваться? Субъекты МСП: сначала в ЕИС в сфере закупок. Затем на этой странице сайта Росэлторг войдите, выбрав способ «ЕРУЗ (Госуслуги)».\n\nЮрлица, ИП, физлица (в т. ч. самозанятые): через Единую регистрацию Росэлторг. Хочу предлагать мои товары/работы/услуги по капремонту многоквартирных домов на торгах по 615 ПП РФ.\n\nГде и как мне регистрироваться? Юрлица, включая субъекты МСП, ИП: сначала в ЕИС в сфере закупок. Затем на этой странице сайта Росэлторг войдите, выбрав «Вход через Госуслуги».\n\nСамозанятые и физлица не могут участвовать в торгах по 615 ПП РФ. Хочу предлагать мои товары, работы и услуги коммерческим компаниям на торгах, нерегулируемых специальным законодательством.\n\nГде и как мне регистрироваться? Юрлица, ИП, субъекты МСП, физлица (в т. ч. самозанятые): с помощью Росэлторг.ID. Хочу предлагать финансовой группе ВТБ мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать энергетической компании «Интер РАО» мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать госкорпорации «Росатом» мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать государственному геологоразведочному холдингу «Росгеология» мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать электросетевому холдингу «Россети» мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать интегрированному провайдеру цифровых услуг «Ростелеком» мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать госкорпорации «Ростех» мои товары, работы услуги.\n\nГде и как мне регистрироваться? Хочу предлагать электроэнергетическому холдингу «РусГидро» мои товары, работы и услуги.\n\nГде и как мне регистрироваться? Хочу предлагать мои товары, работы и услуги в закупках малого объёма (≈ до 3 млн рублей), нерегулируемых специальным законодательством, которые проводят разные компании.\n\nГде и как мне регистрироваться? Через специальную форму. Хочу предлагать мои товары, работы и услуги в закупках малого объёма (≈ до 3 млн рублей), которые проводит госкорпорация «Росатом».\n\nГде и как мне регистрироваться? Через специальную форму. Хочу предлагать мои товары, работы и услуги в закупках малого объёма (≈ до 3 млн рублей), которые проводит энергетическая компания «Интер РАО».\n\nГде и как мне регистрироваться? Через специальную форму. Вариант 1. Через Единую регистрацию Росэлторг. Вариант 2. Через ЕИС в сфере закупок. Вариант 1. Через Росэлторг.ID. Вариант 2. Через ЕИС в сфере закупок. Вариант 1. Через специальную форму. Вариант 2. Через ЕИС в сфере закупок для участия в торгах «Росатома», проводимых по 223-ФЗ среди субъектов МСП. Вариант 1. Через Единую регистрацию Росэлторг. Вариант 2. Через ЕИС в сфере закупок. Вариант 1. Через Единую регистрацию Росэлторг. Вариант 2. Через ЕИС в сфере закупок. Вариант 1. Через Единую регистрацию Росэлторг. Вариант 2. Через ЕИС в сфере закупок. Вариант 1. Через Росэлторг.ID. Вариант 2. Через ЕИС в сфере закупок. Вариант 1. Через Единую регистрацию Росэлторг. Вариант 2. Через ЕИС в сфере закупок."
  },
  {
    "title": "Как регистрироваться заказчикам",
    "url": "https://www.roseltorg.ru/knowledge_db/registration/article/customers",
    "text": "Государственной, муниципальной или иной организации, попадающей под требования законодательства, нужно провести закупку по 44-ФЗ.\n\nГде и как регистрироваться? Сначала в ЕИС в сфере закупок. Затем на этой странице сайта Росэлторг войдите с помощью электронной подписи, нажав на кнопку «ЭП». Госкорпорации или иной организации, попадающей под требования законодательства, нужно провести закупку по 223-ФЗ.\n\nГде и как регистрироваться? Сначала в ЕИС в сфере закупок. Затем на этой странице сайта Росэлторг введите e-mail, придуманный вами пароль, нажмите «Продолжить» и следуйте подсказкам системы — таким образом, вы создадите Росэлторг.ID, необходимый для организаций-заказчиков для этого и прочих видов торгов. Для размещения лотов (процедур) заказчикам следует в личном кабинете Росэлторг.ID аккредитоваться в торговой секции «КОРП» — закупки частных компаний и субъектов 223-ФЗ (включая МСП). Организации, осуществляющая функцию технического заказчика, нужно провести закупку по 615 ПП РФ.\n\nГде и как регистрироваться? Сначала в ЕИС в сфере закупок. Затем на этой странице сайта Росэлторг войдите, выбрав «Вход через Госуслуги». Коммерческая организация хочет провести закупку, нерегулируемую специальным законодательством.\n\nГде и как регистрироваться? На этой странице сайта Росэлторг введите e-mail, придуманный вами пароль, нажмите «Продолжить» и следуйте подсказкам системы — таким образом, вы создадите Росэлторг.ID, необходимый для организаций-заказчиков в данных видах торгов. Для размещения лотов (процедур) заказчикам следует в личном кабинете Росэлторг.ID аккредитоваться в торговой секции «Росэлторг.Бизнес»."
  }
]

# === Подключение к Qdrant ===
client = QdrantClient(host="localhost", port=6333)
collection_name = "docs"

# === Создаем коллекцию (если ещё не создана) ===
client.recreate_collection(
    collection_name=collection_name,
    vectors_config=models.VectorParams(
        size=768,        # размерность эмбеддингов RoSBERTa
        distance=models.Distance.COSINE,
    ),
)

# === Загружаем документы ===
points = []
for doc in docs:
    vector = get_embedding(doc["text"]).tolist()
    point_id = str(uuid.uuid4())  # уникальный id
    points.append(
        models.PointStruct(
            id=point_id,
            vector=vector,
            payload={
                "title": doc["title"],
                "url": doc["url"],
                "text": doc["text"]
            }
        )
    )

# === Отправляем в Qdrant ===
client.upsert(
    collection_name=collection_name,
    wait=True,
    points=points,
)

print(f"✅ Загружено {len(points)} документов в коллекцию '{collection_name}'")
